#!/bin/sh
# Creation graph I/O sur les disques ide

# $Id$

source ../Common
COLORS=(FF0000 0000FF 2AFF00 B5321B 70F00F 178329)
I=0
J=1
for F in $(ls ../data/*hd_io*)
do
    DISC=`basename $F .rrd | sed -e 's/^.*_//g'`
    RRDFILE=$F
    if [ -e $RRDFILE ]
    then
	# Definitions
	DEFS="DEF:ligne$I=$RRDFILE:read_sec:AVERAGE \
	      DEF:ligne$J=$RRDFILE:write_sec:AVERAGE "$DEFS
	INFOS="COMMENT:Lus\n \
	       LINE1:ligne$I#${COLORS[$I]}:$DISC\: \
	       GPRINT:ligne$I:LAST:%8.2lf \
	       GPRINT:ligne$I:MIN:Minimum\:%8.0lf \
	       GPRINT:ligne$I:AVERAGE:Moyenne\:%8.0lf \
	       GPRINT:ligne$I:MAX:Maximum\:%8.0lf\n \
	       COMMENT:Ecrits\n \
	       LINE1:ligne$J#${COLORS[$J]}:$DISC\: \
	       GPRINT:ligne$J:LAST:%8.2lf \
	       GPRINT:ligne$J:MIN:Minimum\:%8.0lf \
	       GPRINT:ligne$J:AVERAGE:Moyenne\:%8.0lf \
	       GPRINT:ligne$J:MAX:Maximum\:%8.0lf\n "$INFOS
	I=`expr $J + 1`
	J=`expr $I + 1`
    fi
done

#-------------------------------------------
# Entree/sorties sur les disques
#-------------------------------------------
LEGENDE="secteurs/sec"
GRAPHFILE=$HOST.disk_io

for VAR in $LISTE
do
    TITRE="Entrees sorties sur les disques sur $VAR"
    GRAPH=$GRAPHDIR/$GRAPHFILE.$VAR.png
    START=e-$VAR
    # Creation du graph
    rrdtool graph $GRAPH -s $START $OPTIONS --title="$TITRE" -v "$LEGENDE" $DEFS $INFOS \
    COMMENT:"$STR_DATE\c" 
done

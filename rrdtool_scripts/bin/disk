#!/bin/sh
# Creation graph espace disque

# $Id$

export PATH=/usr/local/bin:/usr/bin:/bin:/sbin:/usr/sbin
export LANG=fr_FR@euro

HOST=`hostname`
LISTE="48h 12d 48d 576d"

LGDATE=`date +%s`

RRDFILE1=../data/$HOST.slash.rrd
RRDFILE2=../data/$HOST.var.rrd
RRDFILE3=../data/$HOST.home.rrd
RRDFILE4=../data/$HOST.VG1_web.rrd
RRDFILE5=../data/$HOST.VG1_ftp.rrd
RRDFILE6=../data/$HOST.VG1_samba.rrd
GRAPHDIR=/usr2/web/rrd/graphs

STR_DATE="Derniere mise a jour le `date +\"%A %d %B %Y a %T\"`"
COULEURS="-c BACK#000000 -c FONT#AAAAAA -c FRAME#FFFFFF -c CANVAS#000000"
OPTIONS="-w 576 -a PNG -l 0 --alt-autoscale-max $COULEURS"

# Definitions
DEFS="DEF:ligne1=$RRDFILE1:percent:AVERAGE DEF:ligne2=$RRDFILE2:percent:AVERAGE DEF:ligne3=$RRDFILE3:percent:AVERAGE DEF:ligne4=$RRDFILE4:percent:AVERAGE DEF:ligne5=$RRDFILE5:percent:AVERAGE DEF:ligne6=$RRDFILE6:percent:AVERAGE"

#-------------------------------------------
# Espace disque
#-------------------------------------------
LEGENDE="% Total"
GRAPHFILE=$HOST.disk

for VAR in $LISTE
do
	TITRE="Espace disque"
	case $VAR in
		48h)
			GRAPH=$GRAPHDIR/$GRAPHFILE.hourly.png
			START=e-48h
			TITRE="$TITRE sur 48 h"
			;;
		12d)
			GRAPH=$GRAPHDIR/$GRAPHFILE.daily.png
			START=e-12d
			TITRE="$TITRE sur 12 j"
			;;
		48d)
			GRAPH=$GRAPHDIR/$GRAPHFILE.weekly.png
			START=e-48d
			TITRE="$TITRE sur 48 j"
			;;
		576d)
			GRAPH=$GRAPHDIR/$GRAPHFILE.monthly.png
			START=e-576d
			TITRE="$TITRE sur 576 j"
			;;
	esac

# Creation du graph
rrdtool graph $GRAPH -s $START $OPTIONS --title="$TITRE" -v "$LEGENDE" $DEFS \
LINE2:ligne1#00a000:"/           \:" GPRINT:ligne1:LAST:"%8.0lf%% utilise\n" \
LINE2:ligne2#960000:"/var        \:" GPRINT:ligne2:LAST:"%8.0lf%% utilise\n" \
LINE2:ligne3#0000FF:"/home       \:" GPRINT:ligne3:LAST:"%8.0lf%% utilise\n" \
LINE2:ligne4#C53DFF:"/usr2/web   \:" GPRINT:ligne4:LAST:"%8.0lf%% utilise\n" \
LINE2:ligne5#FF0000:"/usr2/ftp   \:" GPRINT:ligne5:LAST:"%8.0lf%% utilise\n" \
LINE2:ligne6#7DD643:"/usr2/samba \:" GPRINT:ligne6:LAST:"%8.0lf%% utilise\n" \
COMMENT:"$STR_DATE\c"
done
